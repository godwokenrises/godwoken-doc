"use strict";(self.webpackChunkckb_sdk=self.webpackChunkckb_sdk||[]).push([[5056],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=s(n),u=o,m=k["".concat(p,".").concat(u)]||k[u]||c[u]||l;return n?a.createElement(m,r(r({ref:t},d),{},{components:n})):a.createElement(m,r({ref:t},d))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,r=new Array(l);r[0]=k;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var s=2;s<l;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(6010);const l="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(l,r),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(3117),o=n(7294),l=n(6010),r=n(2389),i=n(7392),p=n(7094),s=n(2466);const d="tabList__CuJ",c="tabItem_LNqP";function k(e){var t;const{lazy:n,block:r,defaultValue:k,values:u,groupId:m,className:h}=e,g=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=u??g.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),b=(0,i.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===k?k:k??(null==(t=g.find((e=>e.props.default)))?void 0:t.props.value)??g[0].props.value;if(null!==N&&!f.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:w}=(0,p.U)(),[v,_]=(0,o.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,s.o5)();if(null!=m){const e=y[m];null!=e&&e!==v&&f.some((t=>t.value===e))&&_(e)}const x=e=>{const t=e.currentTarget,n=C.indexOf(t),a=f[n].value;a!==v&&(T(t),_(a),null!=m&&w(m,String(a)))},E=e=>{var t;let n=null;switch(e.key){case"Enter":x(e);break;case"ArrowRight":{const t=C.indexOf(e.currentTarget)+1;n=C[t]??C[0];break}case"ArrowLeft":{const t=C.indexOf(e.currentTarget)-1;n=C[t]??C[C.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,l.Z)("tabs-container",d)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":r},h)},f.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:v===t?0:-1,"aria-selected":v===t,key:t,ref:e=>C.push(e),onKeyDown:E,onClick:x},r,{className:(0,l.Z)("tabs__item",c,null==r?void 0:r.className,{"tabs__item--active":v===t})}),n??t)}))),n?(0,o.cloneElement)(g.filter((e=>e.props.value===v))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==v})))))}function u(e){const t=(0,r.Z)();return o.createElement(k,(0,a.Z)({key:String(t)},e))}},9401:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(3117),o=(n(7294),n(3905)),l=(n(4996),n(5488)),r=n(5162);const i={id:"deployment",title:"Deployment"},p=void 0,s={unversionedId:"deployment",id:"version-0.10.4/deployment",title:"Deployment",description:"Deploy a Godwoken Network by Using Godwoken-Kicker",source:"@site/versioned_docs/version-0.10.4/deployment.md",sourceDirName:".",slug:"/deployment",permalink:"/0.10.4/deployment",draft:!1,tags:[],version:"0.10.4",frontMatter:{id:"deployment",title:"Deployment"},sidebar:"sidebar2",previous:{title:"Comparison with EVM",permalink:"/0.10.4/comparisonEVM"},next:{title:"Deploy Ethereum DApps to Godwoken",permalink:"/0.10.4/deployEthDapp"}},d={},c=[{value:"Deploy a Godwoken Network by Using Godwoken-Kicker",id:"deploy-a-godwoken-network-by-using-godwoken-kicker",level:2},{value:"Deploy a Godwoken Network Manually",id:"deploy-a-godwoken-network-manually",level:2},{value:"Environment",id:"environment",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Steps",id:"steps",level:3}],k={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"deploy-a-godwoken-network-by-using-godwoken-kicker"},"Deploy a Godwoken Network by Using Godwoken-Kicker"),(0,o.kt)("p",null,"Godwoken-kicker is a one-line command to start a Godwoken network on ",(0,o.kt)("strong",{parentName:"p"},"Devnet"),". This deployment method helps developers deploy Ethereum contracts and quickly migrate Ethereum DApps to CKB Devnet in testing and development environments."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"RPC URL: http://localhost:8024"),(0,o.kt)("li",{parentName:"ul"},"Chain ID: 1024777")),(0,o.kt)("p",null,"Godwoken-kicker provides a quick mode and a custom mode for deployment."),(0,o.kt)(l.Z,{defaultValue:"quick",values:[{label:"Quick Mode",value:"quick"},{label:"Custom Mode",value:"custom"}],mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"quick",mdxType:"TabItem"},(0,o.kt)("p",null,"The quick mode is fast and simple. It executes the builds of all components from pre-built docker images."),(0,o.kt)("b",null,"Environment"),(0,o.kt)("p",null,(0,o.kt)("ul",null,(0,o.kt)("li",null,"Ubuntu 20.04 LTS"))),(0,o.kt)("b",null,"Prerequisites"),(0,o.kt)("p",null,(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://docs.docker.com/engine/install/ubuntu/"},"Docker\xa0Engine")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://docs.docker.com/compose/install/"},"Docker\xa0Compose")))),(0,o.kt)("p",null,(0,o.kt)("b",null,"Steps")),(0,o.kt)("ol",null,(0,o.kt)("li",null,(0,o.kt)("p",null,"Clone the source of Godwoken-kicker."),(0,o.kt)("p",null,"If it is already cloned, skip to the next step."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/RetricSu/godwoken-kicker.git\n"))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Initialize Godwoken-kicker."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Stop any running Godwoken network by using the ",(0,o.kt)("code",null,"make stop")," command before initializing Godwoken-kicker. ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd godwoken-kicker\n$ make init\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("code",null,"make init")," command can be used in the following situations:"),(0,o.kt)("ul",null,(0,o.kt)("li",null,"It is the first time to start the Godwoken network."),(0,o.kt)("li",null,"The deployment mode is changed."),(0,o.kt)("li",null,"The CKB chain data and all layer 1 related cache data are deleted."))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Start the Godwoken network."),(0,o.kt)("p",null,"The ",(0,o.kt)("code",null,"make start")," command can be used to start the deployed Godwoken network. The ",(0,o.kt)("code",null,"make start-f")," command can be used to force deploy and start a new Godwoken network."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ make start\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"  Do note that after running the ",(0,o.kt)("code",null,"make clean")," command, run ",(0,o.kt)("code",null,"make init")," again if a reboot is desired. ")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Output"),(0,o.kt)("p",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"Building ckb\nBuilding polyjuice\nBuilding call-polyman\nBuilding godwoken\nBuilding web3\nStarting docker_postgres_1 ... done\nStarting docker_ckb_1      ... done\nStarting docker_polyjuice_1    ... done\nStarting docker_call-polyman_1 ... done\nStarting docker_indexer_1      ... done\nStarting docker_godwoken_1     ... done\nStarting docker_web3_1         ... done\n\nRun commands to monitor background activities: \n\n    make sg (Godwoken)\n    make sp (Polyjuice)\n    make web3 (web3)\n    make call-polyman (setup service)\n\nAll Jobs Done       : [########################################] 100%\n\nGreat! Checkout http://localhost:6100 to deploy contract!\n"))))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Set up an Ethereum wallet."),(0,o.kt)("p",null,"In this example, a MetaMask (an Ethereum Wallet) wallet is set up for the deployment. Add the MetaMask extension in the browser (Firefox, Google Chrome, Brave or Microsoft Edge) and create an account for the wallet."),(0,o.kt)("p",null,"If there is a MetaMask wallet ready to be used, skip to the next step directly.")),(0,o.kt)("li",null,(0,o.kt)("p",null,"After the Godwoken network has been successfully launched, visit the website ",(0,o.kt)("a",null,"http://localhost:6100")," and connect the MetaMask wallet by clicking the ",(0,o.kt)("b",null,"Connect Wallet")," button."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  RPC URL=http://localhost:8024\n  CHAIN ID=1024777\n"))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Deploy an ETH contract to the Godwoken network."),(0,o.kt)("ol",null,(0,o.kt)("li",null,(0,o.kt)("p",null,"Prepare and compile an ETH contract.")),(0,o.kt)("li",null,"Deposit 400 CKB to the ETH wallet on the ",(0,o.kt)("b",null,"ACCOUNTS")," page of the Godwoken network."),(0,o.kt)("li",null,"Deploy the ETH contract that you have compiled on the ",(0,o.kt)("b",null,"CONTRACT")," page of the Godwoken network."))))),(0,o.kt)(r.Z,{value:"custom",mdxType:"TabItem"},(0,o.kt)("p",null,"The custom mode is more flexible for custom requirements. It can build the components from local packages and executes the builds locally."),(0,o.kt)("b",null,"Environment"),(0,o.kt)("p",null,(0,o.kt)("ul",null,(0,o.kt)("li",null,"Ubuntu 20.04 LTS"))),(0,o.kt)("b",null,"Prerequisites"),(0,o.kt)("p",null,(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://docs.docker.com/engine/install/ubuntu/"},"Docker Engine")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://docs.docker.com/compose/install/"},"Docker Compose")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://github.com/nervosnetwork/molecule"},"Moleculec")),(0,o.kt)("li",null,"Rustup nightly"))),(0,o.kt)("p",null,(0,o.kt)("b",null,"Steps")),(0,o.kt)("ol",null,(0,o.kt)("li",null,(0,o.kt)("p",null,"Clone the source of Godwoken-kicker."),(0,o.kt)("p",null,"If it is already cloned, skip to the next step directly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/RetricSu/godwoken-kicker.git\n"))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Set the mode with ",(0,o.kt)("code",null,"true")," under the ",(0,o.kt)("code",null,"[mode]")," section in the ",(0,o.kt)("code",null,"/docker/.build.mode.env")," file for the components that you want to build from local packages."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:'language-title="/docker/.build.mode.env"'},"####[mode]\nMANUAL_BUILD_GODWOKEN=false\nMANUAL_BUILD_WEB3=false\nMANUAL_BUILD_SCRIPTS=false\nMANUAL_BUILD_POLYJUICE=false\n...\n")),(0,o.kt)("p",null,"(Optional) Configure component version under the ",(0,o.kt)("code",null,"[packages]")," section in the ",(0,o.kt)("code",null,"docker/.build.mode.env")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:'language-title="/docker/.build.mode.env"'},"####[packages]\nGODWOKEN_GIT_URL=https://github.com/nervosnetwork/godwoken.git\nGODWOKEN_GIT_CHECKOUT=master\nPOLYMAN_GIT_URL=https://github.com/RetricSu/godwoken-polyman.git\nPOLYMAN_GIT_CHECKOUT=master\nWEB3_GIT_URL=https://github.com/nervosnetwork/godwoken-web3.git\nWEB3_GIT_CHECKOUT=main\n...\n"))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Initialize Godwoken-kicker."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Stop any running Godwoken network by using the ",(0,o.kt)("code",null,"make stop")," command before initializing Godwoken-kicker.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd godwoken-kicker\n$ make init\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("code",null,"make init")," command can be used in the following situations:"),(0,o.kt)("ul",null,(0,o.kt)("li",null,"The first time to start the Godwoken network."),(0,o.kt)("li",null,"The deployment mode is changed."),(0,o.kt)("li",null,"The CKB chain data and all layer 1 related cache data are deleted."))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Start the Godwoken network."),(0,o.kt)("p",null,"The ",(0,o.kt)("code",null,"make start")," command can be used to start the deployed Godwoken network. The ",(0,o.kt)("code",null,"make start-f")," command can be used to force deploy and start a new Godwoken network."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ make start\n")),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Output"),(0,o.kt)("p",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"Building ckb\nBuilding polyjuice\nBuilding call-polyman\nBuilding godwoken\nBuilding web3\nStarting docker_postgres_1 ... done\nStarting docker_ckb_1      ... done\nStarting docker_polyjuice_1    ... done\nStarting docker_call-polyman_1 ... done\nStarting docker_indexer_1      ... done\nStarting docker_godwoken_1     ... done\nStarting docker_web3_1         ... done\n\nRun commands to monitor background activities: \n\n    make sg (Godwoken)\n    make sp (Polyjuice)\n    make web3 (web3)\n    make call-polyman (setup service)\n\nAll Jobs Done       : [########################################] 100%\n\nGreat! Checkout http://localhost:6100 to deploy contract!\n"))))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Set up an Ethereum wallet."),(0,o.kt)("p",null,"In this example, a MetaMask (an Ethereum Wallet) wallet is set up for the deployment. Add the MetaMask extension in the browser (Firefox, Google Chrome, Brave or Microsoft Edge) and create an account for the wallet."),(0,o.kt)("p",null,"If there is a MetaMask wallet ready to be used, skip this and go to the next step directly.")),(0,o.kt)("li",null,(0,o.kt)("p",null,"After the Godwoken network has been successfully launched, visit the website ",(0,o.kt)("a",null,"http://localhost:6100")," and connect the MetaMask wallet by clicking the ",(0,o.kt)("b",null,"Connect Wallet")," button."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  RPC URL=http://localhost:8024\n  CHAIN ID=1024777\n"))),(0,o.kt)("li",null,(0,o.kt)("p",null,"Deploy an ETH contract to the Godwoken network."),(0,o.kt)("ol",null,(0,o.kt)("li",null,(0,o.kt)("p",null,"Prepare and compile an ETH contract.")),(0,o.kt)("li",null,(0,o.kt)("p",null,"Deposit 400 CKB to the ETH wallet on the ",(0,o.kt)("b",null,"ACCOUNTS")," page of the Godwoken network.")),(0,o.kt)("li",null,(0,o.kt)("p",null,"Deploy the ETH contract that you have compiled on the ",(0,o.kt)("b",null,"CONTRACT")," page of the Godwoken network."))))))),(0,o.kt)("p",null,"For more information about the Godwoken-kicker commands, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RetricSu/godwoken-kicker"},"godwoken-kicker"),"."),(0,o.kt)("h2",{id:"deploy-a-godwoken-network-manually"},"Deploy a Godwoken Network Manually"),(0,o.kt)("p",null,"This deployment method is useful in situations such as deploying a Godwoken network on ",(0,o.kt)("b",null,"Testnet")," or ",(0,o.kt)("b",null,"Mainnet"),"."),(0,o.kt)("h3",{id:"environment"},"Environment"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"OS: Ubuntu 20.04")),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"The following tools need to be installed before entering the deployment process:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Node.js (>=12.0.0)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Yarn (version 1.22.5 or above)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"GCC and make"),(0,o.kt)("p",{parentName:"li"},"To install ",(0,o.kt)("inlineCode",{parentName:"p"},"GCC")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"make")," on Ubuntu 20.04, run the following command as root or user with sudo privileges:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ sudo apt update\n$ sudo apt install build-essential\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/capsule/releases/tag/v0.7.0"},"Capsule v0.7.0"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Docker"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Docker")," must be installed for building and deploying Godwoken. For more information about Docker installation, see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/ubuntu/"},"Install Docker Engine on Ubuntu"),"."),(0,o.kt)("p",{parentName:"li"},"To manage Docker as a non-root user, see the Docker documentation of ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/linux-postinstall/"},"Manage Docker as a non-root user"),"."))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ckb-cli: The ckb-cli tool is used for deploying smart contracts. It can be installed from a ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/nervosnetwork/ckb/releases"},"CKB pre-built installer package"),". The verified ckb-cli version in this documentation is ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/nervosnetwork/ckb/releases/tag/v0.42.0"},"v0.42.0"),".")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Rustc v1.54.0")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"llvm and clang"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"sudo apt-get install libclang-dev\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"OpenSSL library"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"sudo apt-get install pkg-config libssl-dev\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/molecule"},"Moleculec v0.7.2")),(0,o.kt)("p",{parentName:"li"},"To install Moleculec:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cargo install moleculec --locked --version 0.7.2\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/tippy/releases"},"Tippy")),(0,o.kt)("p",{parentName:"li"},"Tippy is a tool to help set up and manage CKB nodes. For more information, see ",(0,o.kt)("a",{parentName:"p",href:"https://cryptape.github.io/lumos-doc/docs/reference/ckbnode#install-a-ckb-node-by-using-tippy"},"Install a CKB Node by Using Tippy"),". The verified Tippy version in this documentation is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/tippy/releases/tag/v0.4.0-rc2"},"v0.4.0-rc2"),"."))),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The current user must have permissions to run ckb-cli, Capsule, Moleculec and docker. If the execution of these tools requires sudo commands, that may cause issues during the deployment process.")),(0,o.kt)("h3",{id:"steps"},"Steps"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a CKB account for the deployment."),(0,o.kt)("p",{parentName:"li"},"The account must have enough CKB capacity for the deployment.  For more information about CKB accounts and creating CKB accounts, see ",(0,o.kt)("a",{parentName:"p",href:"https://cryptape.github.io/lumos-doc/docs/reference/ckbaccount"},"CKB Accounts and Capacity"),"."),(0,o.kt)("p",{parentName:"li"},"Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"address:\n  mainnet: ckb1qyqpadsep7yruydz5eaulty4xwc2sn6smhashalnjx\n  testnet: ckt1qyqpadsep7yruydz5eaulty4xwc2sn6smhas2cpv76\nlock_arg: 0x1eb6190f883e11a2a67bcfac9533b0a84f50ddfb\nlock_hash: 0x499aa230ded32812a246778bc718f4d61a47497c1b7352211d241d2ad333ed75\npk: 0xca02cc4b8e0e447e243204dd2e16a1692026bfdd4add502b203975999d3a6909\n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The account information in this documentation is only used for demonstration. Do ",(0,o.kt)("strong",{parentName:"p"},"not")," use these private keys, addresses and args elsewhere."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start the CKB node and the CKB miner."),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Launch the Tippy dashboard."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd tippy-linux-x64\n$ ./Tippy\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Launch a CKB devnet if you haven't set up any chain yet and specify the miner with the account prepared for the deployment.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start the chain and the CKB miner on the Tippy dashboard.")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Clone the Godwoken source."),(0,o.kt)("p",{parentName:"li"},"Open a new terminal window and run the following command to clone the Godwoken source:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone --recursive https://github.com/nervosnetwork/godwoken\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Deploy an SUDT script to the chain."),(0,o.kt)("p",{parentName:"li"},"For mor information, see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.nervos.org/docs/labs/sudtbycapsule#introduction"},"Nervos CKB Docs: Write an SUDT script by Capsule"),"."),(0,o.kt)("p",{parentName:"li"},"Deploy plan  output example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'$ capsule deploy --address ckt1qyqpadsep7yruydz5eaulty4xwc2sn6smhas2cpv76 --fee 0.0002\nDeployment plan:\n---\nmigrated_capacity: 0.0 (CKB)\nnew_occupied_capacity: 17390.0 (CKB)\ntxs_fee_capacity: 0.0002 (CKB)\ntotal_occupied_capacity: 17390.0 (CKB)\nrecipe:\n  cells:\n    - name: my-sudt\n      index: 0\n      tx_hash: "0x07de15f8afbd4b55e5d11248f4cd9f5195c8d96f171af04e7f727042bb0643c6"\n      occupied_capacity: 17390.0 (CKB)\n      data_hash: "0xfe2a574febac93ef4da8e716403be072e4703da736676107d68a5e31b682943f"\n      type_id: "0x5318897f71a58ca55b6325736b8170d92c49096719db7646427709a890a9eea0"\n  dep_groups: []\n\nConfirm deployment? (Yes/No)\ny\nPassword: \n(1/1) Sending tx 07de15f8afbd4b55e5d11248f4cd9f5195c8d96f171af04e7f727042bb0643c6\nDeployment complete\n')),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"tx_hash")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"data_hash")," will be used in the next step to configure the ",(0,o.kt)("inlineCode",{parentName:"p"},"setup-config.json")," file."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Prepare the following files under the ",(0,o.kt)("inlineCode",{parentName:"p"},"/godwoken/deploy")," folder."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"pk"),": The file stores the private key that is used to deploy Godwoken."),(0,o.kt)("p",{parentName:"li"}," Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:'language-title="/godwoken/deploy/pk"'},"0xca02cc4b8e0e447e243204dd2e16a1692026bfdd4add502b203975999d3a6909\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"scripts-build.json"),": The file specifies the pre-built docker image of Godwoken and the repositories of the other components like godwoken_scripts, godwoken_polyjuice and clerkb."),(0,o.kt)("p",{parentName:"li"}," Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'```json title="/godwoken/deploy/scripts-build.json"\n{\n    "prebuild_image": "nervos/godwoken-prebuilds:v0.6.9-rc1",\n    "repos": {\n        "godwoken_scripts": "https://github.com/nervosnetwork/godwoken-scripts#master",\n        "godwoken_polyjuice": "https://github.com/nervosnetwork/godwoken-polyjuice#main",\n        "clerkb": "https://github.com/nervosnetwork/clerkb#v0.4.0"\n    }\n} \n```\n')),(0,o.kt)("p",{parentName:"li"}," For more information about the tags of the ",(0,o.kt)("inlineCode",{parentName:"p"},"prebuild_image"),", see ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/nervos/godwoken-prebuilds/tags?page=1&ordering=last_updated"},"nervos/godwoken-prebuilds"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup-config.json"),": The file provides configurations for the Rollup."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"l1_sudt_script_type_hash"),": The ",(0,o.kt)("inlineCode",{parentName:"p"},"data_hash")," of the deployed SUDT script.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"tx_hash")," (under ",(0,o.kt)("inlineCode",{parentName:"p"},"l1_sudt_cell_dep"),"): The ",(0,o.kt)("inlineCode",{parentName:"p"},"tx_hash")," of the deployed SUDT script.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"cells_lock"),": ",(0,o.kt)("inlineCode",{parentName:"p"},"cells_lock")," is used to unlock/upgrade Rollup scripts. ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"reward_lock"),": ",(0,o.kt)("inlineCode",{parentName:"p"},"reward_lock")," is used to receive challenge rewards. ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"burn_lock"),": ",(0,o.kt)("inlineCode",{parentName:"p"},"burn_lock")," is used to receive burned assets that can be unlocked."),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The file must be configured with correct SUDT script to deposit SUDT successfully.")),(0,o.kt)("p",{parentName:"li"},"Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="/godwoken/deploy/setup-config.json"',title:'"/godwoken/deploy/setup-config.json"'},'{\n  "l1_sudt_script_type_hash": "0xfe2a574febac93ef4da8e716403be072e4703da736676107d68a5e31b682943f",\n  "l1_sudt_cell_dep": {\n    "dep_type": "code",\n    "out_point": {\n      "tx_hash": "0x07de15f8afbd4b55e5d11248f4cd9f5195c8d96f171af04e7f727042bb0643c6",\n      "index": "0x0"\n    }\n  },\n  "node_initial_ckb": 1200000,\n  "cells_lock": {\n    "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    "hash_type": "type",\n    "args": "0x1eb6190f883e11a2a67bcfac9533b0a84f50ddfb"\n  },\n  "reward_lock": {\n    "code_hash": "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",\n    "hash_type": "type",\n    "args": "0x1eb6190f883e11a2a67bcfac9533b0a84f50ddfb"\n  },\n  "burn_lock": {\n    "code_hash": "0x0000000000000000000000000000000000000000000000000000000000000000",\n    "hash_type": "data",\n    "args": "0x"\n  }\n}\n')))))))),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set up Godwoken nodes."),(0,o.kt)("p",{parentName:"li"},"To set up Godwoken nodes:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ cd godwoken\n$ RUST_LOG=info cargo +nightly run --bin gw-tools setup -n 2 -k deploy/pk --network devnet --scripts-build-config deploy/build-scripts.json -c deploy/setup-config.json\n")),(0,o.kt)("p",{parentName:"li"},"This setup command compiles Godwoken scripts, deploys the scripts and layer 2 genesis blocks, and generates configuration files for the Godwoken nodes.  "),(0,o.kt)("p",{parentName:"li"},"The deployment requires approximately 10 minutes to complete depending on network connection."),(0,o.kt)("p",{parentName:"li"},"Output Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"...\n2021-11-19T06:22:47Z INFO  gw_tools::deploy_genesis] tx_hash: 0x4ec4532a4b8c7d799ef30d36df413f1e4aa05402336a3df53b4f9afa5baf52cd\n[2021-11-19T06:22:47Z INFO  gw_tools::utils::transaction] waiting tx 4ec4532a4b8c7d799ef30d36df413f1e4aa05402336a3df53b4f9afa5baf52cd\n[2021-11-19T06:22:52Z INFO  gw_tools::utils::transaction] tx proposed\n[2021-11-19T06:22:57Z INFO  gw_tools::utils::transaction] tx commited\n[2021-11-19T06:22:57Z INFO  gw_tools::setup] Finish\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Configure the receiver lock."),(0,o.kt)("p",{parentName:"li"},"After the setup command is completed, a ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," file is generated under ",(0,o.kt)("inlineCode",{parentName:"p"},"/godwoken/output/node1")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"/godwoken/output/node2"),", and a ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts-deploy-result.json")," file is generated under ",(0,o.kt)("inlineCode",{parentName:"p"},"/godwoken/output"),"."),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/classicalliu/lumos-config-generator/releases/download/v0.1.1/lumos-config-generator-linux-amd64"},"config generator")," tool and generate the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.json")," file for the CKB chain."),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The CKB node must be running when executing the generator to generate the config file.")),(0,o.kt)("p",{parentName:"li"},"To generate the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.json")," file in the project root directory:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./lumos-config-generator-linux-amd64 config.json http://127.0.0.1:8114\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Assign a receiver lock in the node's ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," file. "),(0,o.kt)("p",{parentName:"li"},"The code_hash of the receiver lock is the CODE_HASH of the SECP256K1_BLAKE160 script from the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.json")," file."),(0,o.kt)("p",{parentName:"li"},"The args is the lock args of the deployment cells owner."),(0,o.kt)("p",{parentName:"li"},"Example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="config.toml"',title:'"config.toml"'},"[block_producer.challenger_config.rewards_receiver_lock]\ncode_hash = '0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8'\nhash_type = 'type'\nargs = '0x1eb6190f883e11a2a67bcfac9533b0a84f50ddfb'\n"))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start the Godwoken nodes."),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The default node mode is ",(0,o.kt)("inlineCode",{parentName:"p"},"fullnode"),". It can be modified in ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," to either ",(0,o.kt)("inlineCode",{parentName:"p"},"readonly")," mode or ",(0,o.kt)("inlineCode",{parentName:"p"},"test")," mode."),(0,o.kt)("p",{parentName:"admonition"},"If the two nodes need to be started within the same environment, manually modify the listening port number in the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," file for each node.")),(0,o.kt)("p",{parentName:"li"},"Run the following command to start node1:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ RUST_LOG=info cargo +nightly run --bin godwoken run -c output/node1/config.toml\n")),(0,o.kt)("p",{parentName:"li"},"If an error about the use of unstable library feature is encountered during the process, try the following commands to fix the issue:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cargo install cargo-edit\n$ cargo upgrade --workspace num-bigint\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set up Polyjuice."),(0,o.kt)("p",{parentName:"li"},"Clone the source of godwoken-examples. For more information, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/godwoken-examples"},"godwoken-examples"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone --recursive https://github.com/nervosnetwork/godwoken-examples\n")),(0,o.kt)("p",{parentName:"li"},"Then, create an account on Polyjuice. It will take some time to build index for the first time. "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd godwoken-examples\n$ yarn && yarn run build-all\n# export SCRIPT_DEPLOY_RESULT_PATH=<Path to scripts-deploy-result.json>\n$ export SCRIPT_DEPLOY_RESULT_PATH=~/godwoken/deploy/scripts-deploy-result.json\n# export GODWOKEN_CONFIG_PATH=<Path to godwoken config.toml>\n$ export GODWOKEN_CONFIG_PATH=~/godwoken/deploy/node1/config.toml\n$ yarn run copy-configs\n# LUMOS_CONFIG_FILE=<Path to config.json> node ./packages/tools/lib/account-cli.js deposit -c 40000000000 -p <privkey>\n$ LUMOS_CONFIG_FILE=~/config.json node ./packages/tools/lib/account-cli.js deposit -c 40000000000 -p 0xca02cc4b8e0e447e243204dd2e16a1692026bfdd4add502b203975999d3a6909\n")),(0,o.kt)("p",{parentName:"li"},"For more information about generating the Lumos config file for DEV chain, see ",(0,o.kt)("a",{parentName:"p",href:"https://cryptape.github.io/lumos-doc/docs/guides/config#step-1-generate-the-configjson-file-for-the-dev-chain"},"Generate the config.json file for the DEV chain"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start the web3 server."),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a PostgreSQL instance."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ docker run --name postgres -e POSTGRES_USER=user -e POSTGRES_DB=godwoken -e POSTGRES_PASSWORD=mypassword -d -p 5432:5432 postgres\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Clone the source of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/nervosnetwork/godwoken-web3"},"godwoken-web3"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ git clone https://github.com/nervosnetwork/godwoken-web3\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Prepare the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file under ",(0,o.kt)("inlineCode",{parentName:"p"},"/godwoken-web3/packages/api-server"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ cd godwoken-web3\n$ cat > ./packages/api-server/.env <<EOF\nDATABASE_URL=postgres://user:mypassword@postgres:5432/godwoken\nGODWOKEN_JSON_RPC=http://godwoken:8119\nETH_ACCOUNT_LOCK_HASH=<Eth Account Lock Code Hash>\nROLLUP_TYPE_HASH=<Rollup Type Hash>\nPORT=8024\nCHAIN_ID=1024777\nCREATOR_ACCOUNT_ID=3\nDEFAULT_FROM_ADDRESS=0x1eb6190f883e11a2a67bcfac9533b0a84f50ddfb\nPOLYJUICE_VALIDATOR_TYPE_HASH=<Polyjuice Validator Code Hash>\nL2_SUDT_VALIDATOR_SCRIPT_TYPE_HASH=<L2 Sudt Validator Code Hash>\nTRON_ACCOUNT_LOCK_HASH=<Tron Account Lock Code Hash>\nEOF\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start the web3 server."),(0,o.kt)("p",{parentName:"li"},"To start the web3 server properly, make sure to clear the postgres database, and then run the migration SQL file to recreate the tables before running the server:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ yarn\n$ yarn run migrate:latest\n$ yarn run build:godwoken\n$ yarn run start\n")))))))}u.isMDXComponent=!0}}]);