<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.1 plugin-docs plugin-id-default docs-doc-id-gwtxLife">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Godwoken Transaction | Godwoken Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.godwoken.io/1.1/gwtxLife"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1"><meta data-rh="true" name="docsearch:version" content="1.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1"><meta data-rh="true" property="og:title" content="Godwoken Transaction | Godwoken Docs"><meta data-rh="true" name="description" content="Godwoken is a layer 2 rollup framework for Nervos CKB. It provides scalability and an account-based programming model to CKB. For an overview of Godwoken see this post. This article dives into the innards of Godwoken, explains how it works, and how each individual piece fits together."><meta data-rh="true" property="og:description" content="Godwoken is a layer 2 rollup framework for Nervos CKB. It provides scalability and an account-based programming model to CKB. For an overview of Godwoken see this post. This article dives into the innards of Godwoken, explains how it works, and how each individual piece fits together."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.godwoken.io/1.1/gwtxLife"><link data-rh="true" rel="alternate" href="https://docs.godwoken.io/1.1/gwtxLife" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.godwoken.io/1.1/gwtxLife" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://W0P1A076NN-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-215912231-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Godwoken Docs" href="/opensearch.xml">
<link rel="preconnect" href="https://cryptapeblog.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://cryptapeblog.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.71663f73.css">
<link rel="preload" href="/assets/js/runtime~main.ac570351.js" as="script">
<link rel="preload" href="/assets/js/main.471b44ea.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Godwoken Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/1.1">1.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/gwtxLife">Latest</a></li><li><a class="dropdown__link" href="/1.6/gwtxLife">1.6</a></li><li><a class="dropdown__link" href="/1.5/gwtxLife">1.5</a></li><li><a class="dropdown__link" href="/1.4/gwtxLife">1.4</a></li><li><a class="dropdown__link" href="/1.3-rc1/gwtxLife">1.3-rc1</a></li><li><a class="dropdown__link" href="/1.2-rc1/gwtxLife">1.2-rc1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/1.1/gwtxLife">1.1</a></li><li><a class="dropdown__link" href="/0.10.4">0.10.4</a></li></ul></div><a href="https://github.com/godwokenrises/godwoken" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/TfC9rExfHh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Godwoken" class="themedImage_ToTc themedImage--dark_i4oU"><b>Godwoken Docs</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/1.1">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/1.1">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/1.1/gwtxLife">Godwoken Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/1.1/depAndWthd">Deposit and Withdrawal</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/1.1/godwokenkicker">Deployment</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/1.1/integration">Integration Guide for Ethereum Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/1.1/godwokenbridge">Godwoken Bridge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/1.1/releaseNote">Godwoken V1.1 Release Note</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/1.1/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Godwoken Docs<!-- --> <b>1.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/gwtxLife">latest version</a></b> (<!-- -->Latest<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Introduction</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Godwoken Transaction</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Godwoken Transaction</h1></header><p>Godwoken is a layer 2 rollup framework for <a href="https://github.com/nervosnetwork/ckb" target="_blank" rel="noopener noreferrer">Nervos CKB</a>. It provides scalability and an account-based programming model to CKB. For an overview of Godwoken see <a href="https://medium.com/nervosnetwork/towards-ckb-style-lego-pieces-polyjuice-on-godwoken-cbc935d77abf" target="_blank" rel="noopener noreferrer">this post</a>. This article dives into the innards of Godwoken, explains how it works, and how each individual piece fits together.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rollup-layer-2-chain">Rollup Layer 2 Chain<a class="hash-link" href="#rollup-layer-2-chain" title="Direct link to heading">​</a></h2><p>Godwoken is fundamentally a layer 2 solution to the layer 1 of Nervos CKB blockchain. <a href="https://pudge.explorer.nervos.org/address/ckt1qpuljza4azfdsrwjzdpea6442yfqadqhv7yzfu5zknlmtusm45hpuqgqcfn63wfumts4lvrryhc35u43q3aaf5euqq6zeas9" target="_blank" rel="noopener noreferrer">Here</a> is an example of a Godwoken deployment on CKB testnet. Layer 2 blocks are submitted to layer 1 in <strong>block submission transactions</strong> that generate CKB cells with cell data containing the current state of the Godwoken blockchain. For more information about block submission transactions, <a href="https://pudge.explorer.nervos.org/transaction/0x9fd03b09d27326aa54dc53e11d7f7c01f27e570bdc645233b91664323cac0568" target="_blank" rel="noopener noreferrer">see the transaction</a>. As of this layer 2 block, the chain state is as follows:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">0xa0cf6037bfc238b179b74a30a9b12e15a4fbdd8881aebc8e5a66a8b5b5c95f0a4ca62a4c652697c96b7e02eea3a1bc21c5369bcb30626b9aee1cbb1babea11ff4f16000055a255f47f22b6f8ed1a025f971d60528f5407b7c71745c8c493a51a631bb4bfab6f000000000000000000000000000000000000000000000000000000000000000000000000000047ee34be61c51e026838c5348ab0ca3566eed50dc9b3dc676fe16a7f7d72f80fcfe4f3d680010000466f0000000000000001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is actually a <code>GlobalState</code> data structure serialized in <a href="https://github.com/nervosnetwork/molecule" target="_blank" rel="noopener noreferrer">molecule</a> format:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct GlobalState </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rollup_config_hash</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Byte32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    account</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> AccountMerkleState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    block</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> BlockMerkleState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reverted_block_root</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Byte32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tip_block_hash</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Byte32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tip_block_timestamp</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Uint64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    last_finalized_block_number</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Uint64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 0: running, 1: halting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    status</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    version</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More definitions can be found in <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol" target="_blank" rel="noopener noreferrer">this file</a>.</p><p>The block submission transaction also contains the actual layer 2 Godwoken block. The first witness of the <a href="https://pudge.explorer.nervos.org/transaction/0x9fd03b09d27326aa54dc53e11d7f7c01f27e570bdc645233b91664323cac0568" target="_blank" rel="noopener noreferrer">transaction</a> mentioned above contains the following data:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x600300001000000069000000690000005500000055000000100000005500000055000000410000004082de966ef59f3777d5c6b447d7912a457cb6bffc6317f336b03f39930c4c0f474779d431f4832a4779a804880f0d1ff4e9a48554ca8e85b56511c982c2094400f302000000000000ef02000010000000e7020000eb020000d70200001c0000006c010000700100007401000078010000d3020000500100002c000000340000005400000074000000940000009c000000c0000000e4000000e80000000c010000aa6f0000000000001c0000000200000014000000715ab282b873b79a7be8b0e8c13c4e8966a52040c822d671a8097366aacd98746a00407cd378b54b2facb8ac8fe8970e447ced1ff245705db4fe72be953e4f9ee3808a1700a578341aa80a8b2349c236c4af64e5cfe4f3d6800100004ca62a4c652697c96b7e02eea3a1bc21c5369bcb30626b9aee1cbb1babea11ff4f1600004ca62a4c652697c96b7e02eea3a1bc21c5369bcb30626b9aee1cbb1babea11ff4f1600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011b7aeea1224e8e80173fe93db2187d0251d4b41f00e61fe3c3433f0e6953800000000000000000004000000570100004c4f0150f4dad550e8b95696636f041140059724eacb55453d70a18072520c97411ae6b64f01501e5a5863aa3e7d66c1e19a26b1eaac8183aa59e9ce8d77db4e2cb30b65d95b534f01505677593a7fbb2a4ecf82f3b1f7bee953c0199d4c9d6552154a95d844635901e64f0150870913864cfddf50dc51a88b5ca5b8bdf95c476a068fbd2eaa19398318703af05060f8c8c082fafd59eca27762ccbebc580271e0bac92f7a381c739d1954f1c6c9508c4c5f7fb230bee4a9877f3039feb2675dd44d04e8ac0e41dd9f9e13f277119f503e6ee57e32132b778b0e14a9a06b185c73c4a4d01b6cab9370991c3897f90f7050dc2f0723654791da20e1dc7713e167d58c71ceac4839364a6e5033f07f00efc14f0150ad18935a95613207b9baec1fb60f35eab69f273e3423ddb58cb37d886205488650b32cd6babf0fd7a5506a00365d252bc7162f527f4123ec22dcb51ad9336797294ff1040000000000000000000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is actually the <code>WitnessArgs</code> data structure described <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/blockchain.mol#L116" target="_blank" rel="noopener noreferrer">here</a> and is serialized in the <a href="https://github.com/nervosnetwork/molecule" target="_blank" rel="noopener noreferrer">molecule</a> format. In the <code>output_type</code> field of WitnessArgs, the actual <code>L2Block</code> data structure is stored and serialized in the molecule format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table L2Block {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    raw: RawL2Block,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    kv_state: KVPairVec,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    kv_state_proof: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transactions: L2TransactionVec,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    block_proof: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    withdrawals: WithdrawalRequestVec,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Further details about <code>L2Block</code>, refer to <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L114" target="_blank" rel="noopener noreferrer">this file</a>.</p><p>An output cell containing the <code>GlobalState</code> is the <strong>rollup cell</strong>, as this cell contains all the latest information for a particular Godwoken rollup deployment. Godwoken has no restrictions on the number of the rollup cells permitted in CKB. Multiple Godwoken deployments can be setup in a single CKB blockchain for different purposes. Each Godwoken deployment is thus identified by a rollup cell.</p><p>In Godwoken, the rollup cell for each Godwoken deployment must use a script called the <strong>state validator</strong>, which is a Godwoken type script. This script is responsible for:</p><ul><li>Enforce the <a href="https://xuejie.space/2020_02_03_introduction_to_ckb_script_programming_type_id/" target="_blank" rel="noopener noreferrer">type ID</a> logic. This gives each rollup cell an ID, so that there is no need to refer to rollup cell&#x27;s <a href="https://docs.nervos.org/docs/basics/glossary#outpoint" target="_blank" rel="noopener noreferrer">OutPoint</a>, which changes each time the rollup cell is updated. The <a href="https://docs.nervos.org/docs/basics/glossary#type-script-hash" target="_blank" rel="noopener noreferrer">type script hash</a> of the rollup cell is also known as <strong>rollup type hash</strong> of the current Godwoken deployment. A rollup type hash can also be considered as a chain ID that uniquely identifies each layer 2 Godwoken blockchain.</li><li>Enforce Godwoken&#x27;s own checking logic. The state validator type script ensures that the <code>GlobalState</code> is indeed calculated from the current L2 block. (<strong>TODO</strong>: state validator validation rules).</li></ul><p>The state validator type script is the backbone of Godwoken. It ensures all the security checks are performed on chain and all layer 2 funds remain secure in a decentralized environment.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="storage">Storage<a class="hash-link" href="#storage" title="Direct link to heading">​</a></h3><p>Godwoken provides an account model to Nervos CKB:</p><ul><li>A 256-bit key-value storage is provided for applications running on Godwoken.</li><li>Godwoken provides a sequential model conceptually: each layer 2 transaction is applied sequentially to the Godwoken storage. Smart contracts in layer 2 transactions are free to read from and write into the storage space.</li></ul><p>Given the constant storage requirements in the above transactions, you may wonder where to store all the data. Godwoken leverages <a href="https://medium.com/@kelvinfichter/whats-a-sparse-merkle-tree-acda70aeb837" target="_blank" rel="noopener noreferrer">Sparse Merkle Tree</a> to build the storage space. The rollup cell only contains the root hash of the Sparse Merkle Tree (SMT). State validator verifies that the sparse merkle tree is correctly updated in each layer 2 block. In fact, we have moved one step further here by building an optimized SMT, which can save a lot of space and calculation for CKB&#x27;s use case. More details can be found <a href="https://github.com/nervosnetwork/sparse-merkle-tree" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimistic-rollup">Optimistic Rollup<a class="hash-link" href="#optimistic-rollup" title="Direct link to heading">​</a></h3><p>The workflow of Godwoken is as shown below:</p><img loading="lazy" src="/img/gwtx.png" width="70%" class="img_ev3q"><ul><li>Individual parties known as <em>aggregators</em> can collect layer 2 Godwoken transactions(with more details on layer 2 transactions explained below), then pack them into layer 2 blocks and submit them to CKB. Aggregators must stake a certain amount of CKB before they can submit a layer 2 block.</li><li>Each layer 2 block submitted to the chain is initially marked as <strong>unfinalized</strong>. An unfinalized layer 2 block may be challenged by others(known as <strong>challengers</strong>) if it appears malicious, .<ul><li>A challenger starts a challenge request by marking a layer 2 transaction in the layer 2 block as invalid. The challenger must stake a certain amount of CKB in order to create a challenge. Once a challenge request is included in CKB, the challenge phase begins.</li><li>In the challenge phase(detailed below), the original aggregator that submitted the block must prove the marked layer 2 transaction is correct. The aggregator can submit a cancel challenge request to prove its correctness,  which executes the marked layer 2 transaction on chain. CKB only accepts valid transactions on chain, which means the layer 2 transaction must succeed for the cancel challenge request to be committed on chain. In a cancel challenge request, the aggregator can claim staked tokens from the challenger.</li><li>If an aggregator fails to prove the layer 2 transaction is valid by canceling the challenge request, the challenger can then claim tokens staked by the aggregator and revert the chain to the state as it was before the invalid layer 2 block.</li></ul></li><li>An unfinalized layer 2 block will be finalized over a certain period of time. Finalized layer 2 blocks will be frozen and cannot be challenged.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p> This is slightly different from the typical optimistic rollover: a transaction being executed here is simply to prove the transaction is valid, and a timeout indicates challenge success in this case.  </p></div></div><p>In this design, an aggregator bears the liquidity costs for staking CKB, as well as layer 1 transaction fees for the layer 1 transactions containing layer 2 blocks. In exchange, the aggregator can charge layer 2 transaction fees from layer 2 users. As explained below, layer 2 transaction fees can be paid in CKB or any kind of <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0025-simple-udt/0025-simple-udt.md" target="_blank" rel="noopener noreferrer">sUDT</a>. In fact, Godwoken treats CKB and sUDTs as indentical in layer 2.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multiple-block-producers">Multiple Block Producers<a class="hash-link" href="#multiple-block-producers" title="Direct link to heading">​</a></h3><p>Godwoken is designed based on the assumption that anyone can propose layer2 blocks. But in the current deployment, Godwoken only has one block producer to sequence transactions and propose new blocks. Supporting multiple block producers (or sequencers) is still an open question for different rollups. In the future, we may introduce a consensus through an upgrade to support multiple block producer coordination.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="actions">Actions<a class="hash-link" href="#actions" title="Direct link to heading">​</a></h2><p>This sections contains an explanation of the actions that are available on Godwoken, along with detailed technical information on each action.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="deposit">Deposit<a class="hash-link" href="#deposit" title="Direct link to heading">​</a></h3><p>To use Godwoken, you must first deposit some tokens (CKB or sUDT) from layer 1 to layer 2. This is called a <strong>deposit</strong> action. The deposit action is represented as a layer 1 transaction. It must create a special output cell called a <strong>deposit cell</strong>. <a href="https://pudge.explorer.nervos.org/transaction/0xb3aceeb1d84ea5b24e4b8fe339fc6e7814f1e58ebc99237068f22a6924501a1e" target="_blank" rel="noopener noreferrer">Here</a> is an example of a deposit action. This transaction deposits 10000 CKB to Godwoken. All that matters here is the lock script of output cell #0:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;code_hash&quot;: &quot;0x50704b84ecb4c4b12b43c7acb260ddd69171c21b4c0ba15f3c469b7d143f6f18&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;args&quot;: &quot;0x702359ea7f073558921eb50d8c1c77e92f760c8f8656bde4995f26b8963e2dd8a900000014000000340000009d000000a5000000e13f4a9c1642a6c59766eb5509580808bf3917bba104a616df0d207c93050e596900000010000000300000003100000007521d0aa8e66ef441ebc31204d86bb23fc83e9edc58c19dbb1b0ebe64336ec00134000000702359ea7f073558921eb50d8c1c77e92f760c8f8656bde4995f26b8963e2dd8e8ae579256c3b84efb76bbb69cb6bcbef1375f00813a0900000000c002000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hash_type&quot;: &quot;type&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>code_hash</code> and <code>hash_type</code> are pre-determined by each Godwoken deployment. <code>args</code> contains two parts:<strong>rollup type hash</strong> and <strong>DepositLockArgs</strong>. The first 32 bytes of <code>args</code> contain the <strong>rollup type hash</strong> of the current Godwoken deployment, which functions as a chain ID. The <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L177" target="_blank" rel="noopener noreferrer">DepositLockArgs</a> data structure is serialized in molecule format as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table DepositLockArgs {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // layer1 lock hash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner_lock_hash: Byte32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    layer2_lock: Script,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cancel_timeout: Uint64,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    registry_id: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The data structure above contains 2 parts of information:</p><ul><li><code>layer2_lock</code> specifies the lock script to be used when Godwoken transfers the tokens to layer 2.</li><li>If Godwoken ignores the request(e.g. when the network becomes bloated), <code>owner_lock_hash</code> and <code>cancel_timeout</code> provide a way to redeem the tokens. <code>cancel_timeout</code> specifies a timeout parameter in CKB&#x27;s <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0017-tx-valid-since/0017-tx-valid-since.md" target="_blank" rel="noopener noreferrer">since</a> format. When the timeout has expired, the user can create another request to cancel the deposit action and redeem the tokens for other uses. <code>owner_lock_hash</code> is used to provide the token owner&#x27;s identity in case of a cancel deposit action.</li></ul><p>Godwoken periodically collects all live deposit cells, and include them in layer 2 blocks. It transforms each deposit cell to <strong>custodian cell</strong>, creates (if one does not exist) a layer 2 account correspondingly based on the <code>layer2_lock</code> used in <code>DepositLockArgs</code>, and then put the newly deposited tokens in this account.</p><p>Custodian cells contain all the tokens that are managed internally in Godwoken. This <a href="https://pudge.explorer.nervos.org/transaction/0x6c627c00d215ddc2dc21b6b40c03be8c14d4b7fca06e4d84b97e4bb526e5b135" target="_blank" rel="noopener noreferrer">transaction</a> contains a custodian cell in its output cell #2. Like a deposit cell, a custodian cell is represented by its lock script:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;code_hash&quot;: &quot;0x85ae4db0dd83f428a31deb342e4000af37ce2c9645d9e619df00096e3c50a2bb&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;args&quot;: &quot;0x702359ea7f073558921eb50d8c1c77e92f760c8f8656bde4995f26b8963e2dd8e1000000100000003000000038000000595a1405676547c8ddc083f3413d58d65a1bb9275b5a923ec61dce4e572647cc4c6f000000000000a900000014000000340000009d000000a5000000e13f4a9c1642a6c59766eb5509580808bf3917bba104a616df0d207c93050e596900000010000000300000003100000007521d0aa8e66ef441ebc31204d86bb23fc83e9edc58c19dbb1b0ebe64336ec00134000000702359ea7f073558921eb50d8c1c77e92f760c8f8656bde4995f26b8963e2dd8e8ae579256c3b84efb76bbb69cb6bcbef1375f00813a0900000000c002000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hash_type&quot;: &quot;type&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Like deposit cells, custodian cells have pre-determined <code>code_hash</code> and <code>hash_type</code> based on Godwoken deployments. The first 32 bytes in <code>args</code> contain the rollup type hash as well. What&#x27;s different here is that <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L188" target="_blank" rel="noopener noreferrer">CustodianLockArgs</a> is used to fill the remaining part of <code>args</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table CustodianLockArgs {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deposit_block_hash: Byte32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deposit_block_number: Uint64,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // used for revert this cell to deposit request cell</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // after finalize, this lock is meaningless</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    deposit_lock_args: DepositLockArgs,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As noted, a custodian cell contains the original deposit information, as well the layer 2 block information in which the original deposit cell is processed.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="layer-2-transfer">Layer 2 Transfer<a class="hash-link" href="#layer-2-transfer" title="Direct link to heading">​</a></h3><p>Once tokens have been deposited and processed by Godwoken, they can be used in layer 2 Godwoken blockchain. A layer 2 Godwoken transaction uses a totally different structure from a layer 1 CKB transaction:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table RawL2Transaction {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // chain id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_id: Uint64,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    from_id: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    to_id: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nonce: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table L2Transaction {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    raw: RawL2Transaction,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    signature: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Full defination and related types can be found in <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L69-L81" target="_blank" rel="noopener noreferrer">this file</a>.</p><p>There are no cells in the layer 2 Godwoken transaction structure. There is only 32-bit integer value representing the accounts, a 32-bit nonce which is not used in layer 1 CKB, as well as a single variable length <code>args</code> part. This layer 2 transaction structure will be detailed piece by piece.</p><p>While all operations on Godwoken can be represented as a <code>L2Transaction</code> in the above format, let&#x27;s start from a simple transfer operation:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;raw&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;chain_id&quot;: &quot;0x116e9&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;from_id&quot;: &quot;0x2&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;to_id&quot;: &quot;0x1&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;nonce&quot;: &quot;0x3&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;args&quot;: &quot;0x01000000040000009001000000000000000000000000000064000000000000000000000000000000&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;signature&quot;: &quot;0x306d9240d6b18eaa29c83b5f4603c9cbd04402d09c3c38063a87c35b9bfe4ce16ffe64b9f20e306a59819cecfd9b72d3f62888305155bd3e48e40742a3cd8a8901&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the JSON representation of <code>L2Transaction</code> data structure. <code>args</code> contains a variable length, free formatted transaction argument data that is interpreted depending on the values of <code>to_id</code>. In this particular example, <code>args</code> contains <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L260" target="_blank" rel="noopener noreferrer">SUDTTransfer</a> data structure in the molecule serialization format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table SUDTTransfer {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Godwoken registry address: (registry_id (4 bytes) | address len(4 bytes) | address)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    to_address: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amount: Uint256,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // paid fee(ckb)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fee: Fee,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A JSON representation for this data structure is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;type&quot;: &quot;SUDTTransfer&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;value&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;to_address&quot;: &quot;0x0200000014000000bb1d13450cfa630728d0390c99957c6948bf7d19&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;amount&quot;: &quot;0x190&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;fee&quot;: &quot;0x64&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we are transferring 400 shannons(denoted by <code>to_id</code> 0x1) from account 0x2(denoted by <code>from_id</code>) to account 0x0200000014000000bb1d13450cfa630728d0390c99957c6948bf7d19(denoted by <code>to_address</code> in <code>SUDTTransfer</code>). In addition, we may need to pay 100 shannons as layer 2 transaction fees. The next 2 sections will discuss layer 2 transaction in more detail.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="account-locks">Account Locks<a class="hash-link" href="#account-locks" title="Direct link to heading">​</a></h4><p>An account lock controls how a signature for a layer 2 transaction is validated. Recall that a deposit cell actually includes a layer 2 lock script in its <code>DepositLockArgs</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">table DepositLockArgs {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    layer2_lock: Script,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // other fields are omitted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When Godwoken sees a <code>layer2_lock</code> in a <code>DepositLockArgs</code> data structure, it first queries its internal storage to locate an account using the particular layer 2 lock script. Godwoken will create a new account for this lock script if there is none, and assign a 32-bit integer account ID to it. Godwoken enforces a one-to-one mapping between a layer 2 lock script and account ID:</p><ul><li>Given an account ID, one can look up for the layer 2 lock script in Godwoken.</li><li>Given a layer 2 lock script, there can be at most one account ID using that lock script in current Godwoken deployment</li></ul><p>This provides some handy consequences for us:</p><ul><li>Users do not need to remember their account IDs in a Godwoken deployment. As long as they know their wallet addresses, they will be able to query the correct account ID when translated to layer 2 lock script;</li><li>A layer 2 transaction can only include the account ID, which can be used to query the actual layer 2 lock script. This results in smaller layer 2 transaction and bigger throughput.</li></ul><p>Users can choose any lock script to use in layer 2 while still minimizing layer 2 transaction size. This approach offers the advantage that layer 1 is as flexible as layer 2.</p><p>We developed Godwoken in conjunction with Polyjuice, our Ethereum-compatible solution. Furthermore, we provide an Ethereum compatible lock that enables you to use <a href="https://metamask.io/" target="_blank" rel="noopener noreferrer">MetaMask</a> in conjunction with Polyjuice. In practice, this feature has a broader application with different layer 2 locks. An example of this would be a lock that implements the EOS signature validation logic that enables an EOS wallet to call Ethereum dApps through Polyjuice. The entire interoperability power of Nervos CKB is preserved in Godwoken as well.</p><p>Now we can derive the signature validation rule for a layer 2 Godwoken transaction:</p><ul><li>Godwoken locates the corresponding layer 2 lock script by using <code>from_id</code> in the layer 2 transaction.</li><li>The layer 2 lock script is executed to validate the layer 2 transaction.</li></ul><p>The above flow has one quirk: the current version of Godwoken uses the optimistic rollup design. Due to the &quot;optimistic&quot; nature, the layer 2 lock script is not typically executed on chain. It is only executed when a challenger initiates a challenge request on chain, and an aggregator validates the validity of the layer 2 transaction through a cancel challenge request. Hence the way to build a layer 2 lock script is also slightly different. An example of such a script can be found <a href="https://github.com/nervosnetwork/godwoken-scripts/blob/master/contracts/eth-account-lock/src/entry.rs#L24" target="_blank" rel="noopener noreferrer">here</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="backend">Backend<a class="hash-link" href="#backend" title="Direct link to heading">​</a></h4><p>After the signature has been verigied, another problem arises: how does Godwoken calculate the next on-layer2-chain state? <strong>Backends</strong> in Godwoken handle this task.</p><p>Godwoken actually has 2 kinds of accounts:</p><ul><li>Typical user accounts denoted by an account lock.</li><li>Contract accounts denoted by a backend script.</li></ul><p>This design is quite similar to the EOA vs. contract account in Ethereum, which is appropriate because Godwoken was inspired by Ethereum.</p><p>A typical user account is a balance owned by the user, while a contract account provides storage for the on-chain smart contracts. The user account is generated from a general lock script with a user&#x27;s public key hash. The smart contract for the contract account is generated from a backend with some special script args. In the Nervos ecosystem, smart contracts are also represented using the unified <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/blockchain.mol#L32" target="_blank" rel="noopener noreferrer">script</a> data structure: the combination of <code>code_hash</code> and <code>hash_type</code> in a script identifies the backend, while args provides specific contract account arguments. </p><p>In the light of the above, the following rule can be introduced for executing backends:</p><ul><li>Godwoken locates the corresponding backend script by using <code>to_id</code> in the layer 2 transaction;</li><li>The backend script is executed to calculate the state after applying the current transaction.</li></ul><p>Similar to account locks, the above rule is more of a conceptual rule. The actual backend script is only executed on-chain in a cancel challenge request.</p><p>Here are a few examples of backends:</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sudt">SUDT<a class="hash-link" href="#sudt" title="Direct link to heading">​</a></h5><p>sUDT is the most common backend in Godwoken and all tokens, whether they are CKB or layer 1 sUDTs, are represented as layer 2 sUDT types. A layer 2 sUDT backend script is defined by the following specification:</p><ul><li><code>code_hash</code> and <code>hash_type</code> are pre-determined by each Godwoken deployment.</li><li><code>args</code> contains the script hash of layer 1 sUDT type script. In case CKB is used, <code>args</code> will be <code>0x0000000000000000000000000000000000000000000000000000000000000000</code>.</li></ul><p>In this way, we can correlate layer 1 sUDT type scrips with its corresponding layer 2 sUDT backend script.</p><p>The layer 2 sUDT backend provides <a href="https://eips.ethereum.org/EIPS/eip-20" target="_blank" rel="noopener noreferrer">ERC20</a> compatible interface. You may not using Solidity and EVM, but a similar API is available for you to use.</p><p>Layer 2 transaction using a sUDT backend must provided a <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L250" target="_blank" rel="noopener noreferrer">SUDTArgs</a> data structure serialized in molecule format in layer 2 transaction args. The two supported actions for sUDT backend is <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L255" target="_blank" rel="noopener noreferrer">SUDTQuery</a> and <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L260" target="_blank" rel="noopener noreferrer">SUDTTransfer</a>. Later versions may expand this list to include other ERC20 operations.</p><p>Note that Godwoken typically creates sUDT contract accounts when processing deposit cells. It doesn&#x27;t create new contract accounts using sUDT as the backend script.</p><p>An implementation for the layer 2 sUDT backend can be found <a href="https://github.com/nervosnetwork/godwoken-scripts/blob/v1.1.0-beta/c/contracts/sudt.c" target="_blank" rel="noopener noreferrer">here</a>.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="metacontract">MetaContract<a class="hash-link" href="#metacontract" title="Direct link to heading">​</a></h5><p>MetaContract is a special backend in Godwoken:</p><ul><li>It is reserved as account ID 0;</li><li>You cannot create a new contract account using MetaContract as the backend.</li></ul><p>The sole purpose of MetaContract now is to create contract account given a particular backend.</p><p>Here is the JSON representation for a layer 2 transaction, which invokes MetaContract to create a Polyjuice root contract account:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;raw&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;chain_id&quot;: &quot;0x116e9&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;from_id&quot;: &quot;0x2&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;to_id&quot;: &quot;0x0&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;nonce&quot;: &quot;0x4&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;args&quot;: &quot;0x0000000041000000080000003900000010000000300000003100000020814f4f3ebaf8a297d452aa38dbf0f9cb0b2988a87cb6119c2497de817e7de9000400000001000000&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;signature&quot;: &quot;0xc62d332f398323b972c5ee5c4481661ca9d17125af6f61e5220e2fbfe3bd325a0cc6c3ac174950dc1282d5e6059fc08838b9040ed7eca0ad13474af869f25a8701&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>args</code> part in this transaction contains a <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L232" target="_blank" rel="noopener noreferrer">MetaContractArgs</a> data structure serialized in molecule format. A JSON representation for <code>args</code> is as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;type&quot;: &quot;CreateAccount&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;value&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;script&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;code_hash&quot;: &quot;0x20814f4f3ebaf8a297d452aa38dbf0f9cb0b2988a87cb6119c2497de817e7de9&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;hash_type&quot;: &quot;data&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;args&quot;: &quot;0x01000000&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The details of this transaction will be explained in <a href="https://github.com/nervosnetwork/godwoken/blob/develop/docs/life_of_a_polyjuice_transaction.md" target="_blank" rel="noopener noreferrer">Life of a Polyjuice Transaction</a>.</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="polyjuice">Polyjuice<a class="hash-link" href="#polyjuice" title="Direct link to heading">​</a></h5><p>Polyjuice is the main backend used now in Godwoken. It allows us to create a contract account using EVM bytecode. The resulting account will be able to execute smart contracts written for Ethereum. Polyjuice aims at 100% compatibility at EVM level, meaning all applications that runnable on Ethereum can be run on Godwoken powered by Polyjuice.</p><p>For more details on polyjuice, refer to <a href="https://github.com/nervosnetwork/godwoken/blob/develop/docs/life_of_a_polyjuice_transaction.md" target="_blank" rel="noopener noreferrer">Life of a Polyjuice Transaction</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="managing-account-locks--backends">Managing Account Locks &amp; Backends<a class="hash-link" href="#managing-account-locks--backends" title="Direct link to heading">​</a></h4><p>It is possible to create as many accounts as you like. However, Godwoken now only supports whitelisted account locks and backends for security reasons. The list now includes:</p><ul><li>Ethereum compatible account lock</li><li>MetaContract backend</li><li>Layer 2 sUDT backend</li><li>ETH Registry backend</li><li>Polyjuice backend</li></ul><p>If there is a particular account lock or backend that you like, please do not hesistate to let us know. We are interested in a future where an EOS wallet can control an Ethereum application, or a BTC wallet can control a <a href="https://www.diem.com/en-us/" target="_blank" rel="noopener noreferrer">Diem</a> application. This is all possible with Godwoken thanks to the composability of account locks and backends.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="withdraw">Withdraw<a class="hash-link" href="#withdraw" title="Direct link to heading">​</a></h3><p>The <strong>withdraw</strong> action enables you to withdraw tokens from layer 2 back to layer 1. A withdraw action uses the following data structure:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct RawWithdrawalRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nonce: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // chain id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_id: Uint64,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // CKB amount</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    capacity: Uint64,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // SUDT amount</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amount: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sudt_script_hash: Byte32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // layer2 account_script_hash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    account_script_hash: Byte32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // withdrawal registry ID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    registry_id: Uint32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // layer1 lock to withdraw after challenge period</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner_lock_hash: Byte32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // withdrawal fee, paid to block producer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fee: Uint128,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vector WithdrawalRequestVec &lt;WithdrawalRequest&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct WithdrawalRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    raw: RawWithdrawalRequest,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    signature: Bytes,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The full definition and related types can be found in <a href="https://github.com/nervosnetwork/godwoken/blob/v1.1.0-beta/crates/types/schemas/godwoken.mol#L136-L160" target="_blank" rel="noopener noreferrer">this file</a>.</p><p><code>WithdrawalRequest</code> uses <code>account_script_hash</code> as a key to locate the account lock and perform the same signature verification flow as layer 2 transaction. The Withdraw action can be used to withdraw CKB and a layer 1 sUDT type simutaneously. Due to the constraint of CKB&#x27;s cell model, Godwoken currently requires a minimum of 400 CKBytes  for each withdrawal.</p><p><code>WithdrawalRequest</code> contains additional fields that are used to fulfill a special feature of Godwoken, the selling of withdrawn tokens. This is explained in the next section.</p><p>Here is the JSON representation of a <code>WithdrawalRequest</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;raw&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;nonce&quot;: &quot;0x3&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;chain_id&quot;: &quot;0x116e9&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;capacity&quot;: &quot;0x9502f9000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;amount&quot;: &quot;0x0&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;registry_id&quot;: &quot;0x2&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sudt_script_hash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;account_script_hash&quot;: &quot;0x167d7855f41c343e2064fc5b62f7d640d2d74a8255766bff62f1f5fc63ab4c58&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;owner_lock_hash&quot;: &quot;0xa35eda3e71e86e4e22b7924012b6a6e90809dc7a68621d5f7a7c40eea01be45e&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;signature&quot;: &quot;0xef1a36bb7cbd3884bf404811ed0e534b4ef3f87abe52f44838018b3af7c7a5534cd1b0b5c1cb55a32b122278ebc9fe37a92e2442ba83160e778163eafd444b9700&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/1.1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/1.1/depAndWthd"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deposit and Withdrawal</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rollup-layer-2-chain" class="table-of-contents__link toc-highlight">Rollup Layer 2 Chain</a><ul><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#optimistic-rollup" class="table-of-contents__link toc-highlight">Optimistic Rollup</a></li><li><a href="#multiple-block-producers" class="table-of-contents__link toc-highlight">Multiple Block Producers</a></li></ul></li><li><a href="#actions" class="table-of-contents__link toc-highlight">Actions</a><ul><li><a href="#deposit" class="table-of-contents__link toc-highlight">Deposit</a></li><li><a href="#layer-2-transfer" class="table-of-contents__link toc-highlight">Layer 2 Transfer</a></li><li><a href="#withdraw" class="table-of-contents__link toc-highlight">Withdraw</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Godwoken. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ac570351.js"></script>
<script src="/assets/js/main.471b44ea.js"></script>
</body>
</html>